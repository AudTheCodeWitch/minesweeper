$: << 'lib'
require 'minefield'
require 'minefield_printer'
require 'prompt'

minefield = if ENV['SHUFFLE'] != nil
  Minefield.new(width: 10, height: 10, mine_count: 1, seed: :none)
else
  Minefield.new(width: 10, height: 10, mine_count: 1)
end

printer = MinefieldPrinter.new(minefield)
prompt = Prompt.new

prompt.welcome
puts printer

while(!minefield.cleared?) do
  begin
    input = prompt.reveal_at
  rescue Prompt::UserInputError
    prompt.exit
    exit
  end

  input.each do |coords|
    cell = minefield.reveal_at(coords.fetch(:x), coords.fetch(:y))
    if cell.mine?
      puts printer
      prompt.lose
      prompt.exit
      exit
    end
  end
  puts printer
end

prompt.win
prompt.exit
exit
